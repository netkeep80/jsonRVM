# Математическое описание Модели Отношений

## Введение

Данный документ описывает математическую формализацию Модели Отношений (МО) в терминах теории множеств с точки зрения [Теории связей](https://habr.com/ru/articles/895896/).

Модель Отношений — это язык метапрограммирования, основанный на концепции триединой сущности. В отличие от традиционных подходов к программированию, где используются две базовые концепции (данные и функции), в МО всё представляется единой концепцией — сущностью.

## 1. Базовые определения

### 1.1. Ссылки на сущности

**Определение 1.1 (Множество ссылок).** Пусть L ⊆ ℕ₀ — множество натуральных чисел, используемых в качестве уникальных идентификаторов (ссылок) на сущности.

```
L = {0, 1, 2, 3, ...} ⊆ ℕ₀
```

Каждая ссылка l ∈ L однозначно идентифицирует сущность в Модели Отношений.

### 1.2. Триплеты и Дуплеты

**Определение 1.2 (Вектор ссылок).** Множество всех векторов ссылок длины n ∈ ℕ₀:

```
Vₙ = Lⁿ
```

где Lⁿ — декартова степень множества L.

**Определение 1.3 (Дуплет).** Дуплет (упорядоченная пара ссылок) — это элемент множества:

```
D = L² = L × L = {(b, e) : b ∈ L, e ∈ L}
```

где:
- b — begin (начало)
- e — end (конец)

**Определение 1.4 (Триплет).** Триплет (кортеж длины 3) — это элемент множества:

```
T = L³ = L × L × L = {(r, s, o) : r ∈ L, s ∈ L, o ∈ L}
```

или эквивалентно:

```
T = L × D, где D = L × L
```

где:
- r — ссылка на отношение
- s — ссылка на субъект
- o — ссылка на объект

### 1.3. Представление триплета через вложенные упорядоченные пары

С точки зрения теории множеств, триплет можно представить как вложенные упорядоченные пары:

```
(r, s, o) = (r, (s, o)) = (e, d)
```

где:
- e — ссылка на сущность (в роли отношения)
- d = (s, o) — дуплет (субъект-объект)

Это соответствует представлению кортежа через пару Куратовского.

## 2. Внутренняя структура связей

### 2.1. Два аспекта сущности

В Модели Отношений каждая сущность может определяться через связи:

```
E = ER    (сущность определяется парой сущность-отношение)
R = SO    (отношение определяется парой субъект-объект)
S ⊆ E     (субъекты — подмножество сущностей)
O ⊆ E     (объекты — подмножество сущностей)
```

### 2.2. Типы связей (дуплетов)

Определим два базовых типа связей:

```
SO ⊆ S × O = {(s, o) : s ∈ E, o ∈ E}
ER ⊆ E × R = {(e, r) : e ∈ E, r ∈ E}
```

где:
- SO — дуплет субъект-объект, определяющий отношение
- ER — дуплет сущность-отношение, определяющий сущность

## 3. Сведение триплетов к дуплетам

### 3.1. Теорема об эквивалентности представлений

**Теорема 3.1.** Множество RM может быть эквивалентно представлено двумя подмножествами дуплетов:

```
RM = {ER, SO}
```

где:
```
E = ER ⊆ E × R = {(e, r) : e ∈ E, r ∈ E}
R = SO ⊆ S × O = {(s, o) : s ∈ E, o ∈ E}
```

### 3.2. Доказательство эквивалентности

Триплет эквивалентен комбинации двух дуплетов:

```
t = (r, s, o) = (r, (s, o)) = (e, d)
```

где:
- e ∈ E — сущность в роли отношения
- d = (s, o) ∈ SO — дуплет субъект-объект

Таким образом, каждый триплет однозначно определяется:
1. Ссылкой на сущность-отношение (e)
2. Дуплетом субъект-объект (d = (s, o))

## 4. Модель Отношений как функция

### 4.1. Определение из Теории связей

**Определение 4.1 (Ассоциация).** Ассоциация — это упорядоченная пара, состоящая из ссылки и вектора ссылок:

```
A = L × Vₙ
```

**Определение 4.2 (Ассоциативная сеть n-мерных векторов).** Ассоциативная сеть — это функция:

```
anetⁿ : L → Vₙ
```

отображающая ссылку l из множества L в вектор ссылок длины n.

**Определение 4.3 (Ассоциативная сеть дуплетов).** Ассоциативная сеть дуплетов (двумерная асеть):

```
anetd : L → L²
```

### 4.2. Модель Отношений как функция

**Определение 4.4 (Модель Отношений).** Модель Отношений может быть представлена как функция:

```
rm : E → E × E × E = E³
```

где каждая сущность с идентификатором e отображается в триплет (r, s, o).

Эквивалентно, с учётом структуры вложенных пар:

```
rm : E → E × (E × E)
rm(e) = (r, (s, o))
```

### 4.3. Сведение к двумерной асети

**Теорема 4.1.** Трёхмерная ассоциативная сеть может быть преобразована в двумерную ассоциативную сеть (асеть дуплетов) без потери информации.

Преобразование выполняется через вложенные упорядоченные пары:

```
anetl : L → NP
```

где NP = {∅ | (l, np), l ∈ L, np ∈ NP} — множество вложенных упорядоченных пар.

## 5. Триединая сущность

### 5.1. Определение триединой сущности

**Определение 5.1.** Триединая сущность — это элемент Модели Отношений, определяемый триплетом (r, s, o), где:

- **r (relation)** — отношение, определяющее контроллер (Controller)
- **s (subject)** — субъект, определяющий представление (View)
- **o (object)** — объект, определяющий модель (Model)

### 5.2. Топологии сущностей

**Определение 5.2 (Топологии).** В зависимости от структуры связей, сущности образуют различные топологии:

1. **Статическое собственное значение** (EntId = SubId = RelId = ObjId):
   ```
   e(e -e-> e)
   ```
   Структура сущности топологически замкнута сама на себя через себя.

2. **Динамическое собственное значение** (EntId = SubId = ObjId):
   ```
   e(e -r-> e)
   ```
   Структура сущности замкнута сама на себя через другую сущность-отношение.

3. **Ссылка/хранилище** (EntId = SubId):
   ```
   e(e -r-> o)
   ```
   Сущность сохраняет в себе проекцию другой сущности.

4. **Источник проекции** (EntId = ObjId):
   ```
   e(s -r-> e)
   ```
   Сущность формирует собственную проекцию для восприятия другими сущностями.

## 6. Свойства Модели Отношений

### 6.1. Гомоиконичность

Модель Отношений обладает свойством гомоиконичности: код и данные имеют одинаковую структуру (JSON-представление).

### 6.2. Рефлексивность

Модель Отношений поддерживает рефлексию: программа может анализировать и модифицировать собственную структуру во время выполнения.

### 6.3. Замкнутость

**Теорема 6.1 (Замкнутость).** Множества E, S, O эквивалентны. Любая сущность может выступать в роли субъекта, отношения или объекта в других сущностях.

### 6.4. Фрактальность

Структура Модели Отношений является фрактальной: каждая сущность содержит три другие сущности, каждая из которых также триедина.

## 7. JSON-представление

### 7.1. Соответствие типов

| JSON-тип | Интерпретация в МО |
|----------|-------------------|
| Number   | Топологически замкнутая проекция числового отношения |
| Boolean  | Топологически замкнутая проекция булева отношения |
| String   | Топологически замкнутая проекция строкового отношения или имя сущности |
| Object   | Проекция отношения вмещения структуры или сущность (если есть $rel) |
| Array    | Проекция цепочки отношений последовательного следования |
| Null     | Пустое пространство (потенциал вмещения проекции) |

### 7.2. Исполняемые конструкции

Сущность в JSON-представлении определяется объектом с полями:

```json
{
  "$rel": "<отношение>",
  "$sub": "<субъект>",
  "$obj": "<объект>"
}
```

## 8. Аналогия с молекулярной биологией

Интересную аналогию можно провести с принципом комплементарности нуклеотидов в ДНК:

- Аденин (A) соединяется только с тимином (T) — двойная связь
- Гуанин (G) соединяется только с цитозином (C) — тройная связь

Аналогично в Модели Отношений:
- ER сопряжено с SO (сущность-отношение ↔ субъект-объект)

Это свойство сохранения относительного типа ассоциации обеспечивает целостность структуры.

## 9. Заключение

Математическая формализация Модели Отношений в терминах теории множеств показывает, что:

1. Триплеты (кортежи длины 3) могут быть эквивалентно представлены как вложенные упорядоченные пары: (r, s, o) = (r, (s, o)) = (e, d).

2. Модель Отношений является функцией вида rm : E → E³.

3. Два базовых типа дуплетов {ER, SO} достаточны для представления всей модели.

4. Триединая сущность реализует паттерн MVC на уровне базовой структуры языка.

## Литература

1. Теория связей — https://habr.com/ru/articles/895896/
2. Deep Theory — https://github.com/deep-foundation/deep-theory
3. Ассоциативная модель данных — https://en.wikipedia.org/wiki/Associative_model_of_data
4. Бинарные отношения — https://ru.wikipedia.org/wiki/Бинарное_отношение
