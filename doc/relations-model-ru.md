# Математическое описание Модели Отношений

## Введение

Данный документ описывает математическую формализацию Модели Отношений (МО) в терминах теории множеств с точки зрения [Теории связей](https://habr.com/ru/articles/895896/).

Модель Отношений — это язык метапрограммирования, основанный на концепции триединой сущности. В отличие от традиционных подходов к программированию, где используются две базовые концепции (данные и функции), в МО всё представляется единой концепцией — сущностью.

## 1. Базовые определения

### 1.1. Ссылки на сущности

**Определение 1.1 (Множество ссылок).** Пусть L ⊆ ℕ₀ — множество натуральных чисел, используемых в качестве уникальных идентификаторов (ссылок) на сущности.

```
L = {0, 1, 2, 3, ...} ⊆ ℕ₀
```

Каждая ссылка l ∈ L однозначно идентифицирует сущность в Модели Отношений.

### 1.2. Триплеты и Дуплеты

**Определение 1.2 (Вектор ссылок).** Множество всех векторов ссылок длины n ∈ ℕ₀:

```
Vₙ = Lⁿ
```

где Lⁿ — декартова степень множества L.

**Определение 1.3 (Дуплет).** Дуплет (упорядоченная пара ссылок) — это элемент множества:

```
D = L² = L × L = {(a, b) : a ∈ L, b ∈ L}
```

**Определение 1.4 (Триплет).** Триплет (кортеж длины 3) — это элемент множества:

```
T = L³ = L × L × L = {(s, r, o) : s ∈ L, r ∈ L, o ∈ L}
```

где:
- s — ссылка на субъект
- r — ссылка на отношение
- o — ссылка на объект

### 1.3. Представление триплета через вложенные упорядоченные пары

С точки зрения теории множеств, триплет можно представить как вложенные упорядоченные пары:

```
(s, r, o) = ((s, r), o)
```

Это соответствует представлению кортежа через пару Куратовского.

## 2. Модель Отношений как четыре взаимосвязанных множества

### 2.1. Четыре аспекта сущности

В Модели Отношений каждая сущность может выступать в четырёх аспектах (ролях):

1. **E (Entity)** — сущность как целое
2. **R (Relation)** — сущность в роли отношения (контроллера)
3. **S (Subject)** — сущность в роли субъекта (представления)
4. **O (Object)** — сущность в роли объекта (модели)

**Определение 2.1 (Модель Отношений).** Модель Отношений RM представляется как четвёрка взаимосвязанных множеств кортежей длины 3:

```
RM = {E, O, R, S}
```

где:

```
R ⊆ (S × O) × E = {((s, o), e) : s ∈ S, o ∈ O, e ∈ E}
O ⊆ (E × R) × S = {((e, r), s) : e ∈ E, r ∈ R, s ∈ S}
S ⊆ (R × E) × O = {((r, e), o) : r ∈ R, e ∈ E, o ∈ O}
E ⊆ (O × S) × R = {((o, s), r) : o ∈ O, s ∈ S, r ∈ R}
```

### 2.2. Внутренняя структура связей

Внутренний аспект (структура) каждого типа сущности определяется через связи:

```
E = SO    (сущность определяется парой субъект-объект)
R = OS    (отношение определяется парой объект-субъект)
O = ER    (объект определяется парой сущность-отношение)
S = RE    (субъект определяется парой отношение-сущность)
```

### 2.3. Типы связей (дуплетов)

Определим четыре базовых типа связей:

```
OS ⊆ O × S = {(o, s) : o ∈ O, s ∈ S}
SO ⊆ S × O = {(s, o) : s ∈ S, o ∈ O}
RE ⊆ R × E = {(r, e) : r ∈ R, e ∈ E}
ER ⊆ E × R = {(e, r) : e ∈ E, r ∈ R}
```

## 3. Сведение триплетов к дуплетам

### 3.1. Теорема об эквивалентности представлений

**Теорема 3.1.** Множество RM может быть эквивалентно представлено четырьмя множествами дуплетов:

```
RM = {ER, OS, RE, SO}
```

где:
```
E = SO ⊆ SO × OS = {(so, os) : so ∈ SO, os ∈ OS}
O = ER ⊆ ER × RE = {(er, re) : er ∈ ER, re ∈ RE}
R = OS ⊆ OS × SO = {(os, so) : os ∈ OS, so ∈ SO}
S = RE ⊆ RE × ER = {(re, er) : re ∈ RE, er ∈ ER}
```

### 3.2. Доказательство эквивалентности

Кортеж-сущность эквивалентен кортежу субъект-объекта:
```
e = (s, o, r) = ((s, o), r) = (so, r) ≡ so = (so, re)
```

Кортеж-объект эквивалентен кортежу сущность-отношения:
```
o = (e, r, s) = ((e, r), s) = (er, s) ≡ er = (er, so)
```

Кортеж-отношение эквивалентен кортежу объект-субъекта:
```
r = (o, s, e) = ((o, s), e) = (os, e) ≡ os = (os, er)
```

Кортеж-субъект эквивалентен кортежу отношение-сущности:
```
s = (r, e, o) = ((r, e), o) = (re, o) ≡ re = (re, os)
```

## 4. Модель Отношений как ассоциативная сеть

### 4.1. Определения из Теории связей

**Определение 4.1 (Ассоциация).** Ассоциация — это упорядоченная пара, состоящая из ссылки и вектора ссылок:

```
A = L × Vₙ
```

**Определение 4.2 (Ассоциативная сеть n-мерных векторов).** Ассоциативная сеть — это функция:

```
anetⁿ : L → Vₙ
```

отображающая ссылку l из множества L в вектор ссылок длины n.

**Определение 4.3 (Ассоциативная сеть дуплетов).** Ассоциативная сеть дуплетов (двумерная асеть):

```
anetd : L → L²
```

### 4.2. Модель Отношений как трёхмерная ассоциативная сеть

**Теорема 4.1.** Модель Отношений может быть представлена как трёхмерная ассоциативная сеть:

```
λ : L → L × L × L = L³
```

где каждая сущность с идентификатором l отображается в триплет (s, r, o).

### 4.3. Сведение к двумерной асети

**Теорема 4.2.** Трёхмерная ассоциативная сеть может быть преобразована в двумерную ассоциативную сеть (асеть дуплетов) без потери информации.

Преобразование выполняется через вложенные упорядоченные пары:

```
anetl : L → NP
```

где NP = {∅ | (l, np), l ∈ L, np ∈ NP} — множество вложенных упорядоченных пар.

## 5. Триединая сущность

### 5.1. Определение триединой сущности

**Определение 5.1.** Триединая сущность — это элемент Модели Отношений, определяемый триплетом (s, r, o), где:

- **s (subject)** — субъект, определяющий представление (View)
- **r (relation)** — отношение, определяющее контроллер (Controller)
- **o (object)** — объект, определяющий модель (Model)

### 5.2. Топологии сущностей

**Определение 5.2 (Топологии).** В зависимости от структуры связей, сущности образуют различные топологии:

1. **Статическое собственное значение** (EntId = SubId = RelId = ObjId):
   ```
   e(e -e-> e)
   ```
   Структура сущности топологически замкнута сама на себя через себя.

2. **Динамическое собственное значение** (EntId = SubId = ObjId):
   ```
   e(e -r-> e)
   ```
   Структура сущности замкнута сама на себя через другую сущность-отношение.

3. **Ссылка/хранилище** (EntId = SubId):
   ```
   e(e -r-> o)
   ```
   Сущность сохраняет в себе проекцию другой сущности.

4. **Источник проекции** (EntId = ObjId):
   ```
   e(s -r-> e)
   ```
   Сущность формирует собственную проекцию для восприятия другими сущностями.

## 6. Свойства Модели Отношений

### 6.1. Гомоиконичность

Модель Отношений обладает свойством гомоиконичности: код и данные имеют одинаковую структуру (JSON-представление).

### 6.2. Рефлексивность

Модель Отношений поддерживает рефлексию: программа может анализировать и модифицировать собственную структуру во время выполнения.

### 6.3. Замкнутость

**Теорема 6.1 (Замкнутость).** Множества E, O, R, S эквивалентны. Любая сущность может выступать в роли субъекта, отношения или объекта в других сущностях.

### 6.4. Фрактальность

Структура Модели Отношений является фрактальной: каждая сущность содержит три другие сущности, каждая из которых также триедина.

## 7. JSON-представление

### 7.1. Соответствие типов

| JSON-тип | Интерпретация в МО |
|----------|-------------------|
| Number   | Топологически замкнутая проекция числового отношения |
| Boolean  | Топологически замкнутая проекция булева отношения |
| String   | Топологически замкнутая проекция строкового отношения или имя сущности |
| Object   | Проекция отношения вмещения структуры или сущность (если есть $rel) |
| Array    | Проекция цепочки отношений последовательного следования |
| Null     | Пустое пространство (потенциал вмещения проекции) |

### 7.2. Исполняемые конструкции

Сущность в JSON-представлении определяется объектом с полями:

```json
{
  "$sub": "<субъект>",
  "$rel": "<отношение>",
  "$obj": "<объект>"
}
```

## 8. Аналогия с молекулярной биологией

Интересную аналогию можно провести с принципом комплементарности нуклеотидов в ДНК:

- Аденин (A) соединяется только с тимином (T) — двойная связь
- Гуанин (G) соединяется только с цитозином (C) — тройная связь

Аналогично в Модели Отношений:
- OS сопряжено с SO
- ER сопряжено с RE

Это свойство сохранения относительного типа ассоциации обеспечивает целостность структуры.

## 9. Заключение

Математическая формализация Модели Отношений в терминах теории множеств показывает, что:

1. Триплеты (кортежи длины 3) могут быть эквивалентно представлены как вложенные упорядоченные пары (два дуплета).

2. Модель Отношений является трёхмерной ассоциативной сетью вида λ : L → L³.

3. Четыре взаимосвязанных множества {E, O, R, S} эквивалентны четырём множествам дуплетов {ER, OS, RE, SO}.

4. Триединая сущность реализует паттерн MVC на уровне базовой структуры языка.

## Литература

1. Теория связей — https://habr.com/ru/articles/895896/
2. Deep Theory — https://github.com/deep-foundation/deep-theory
3. Ассоциативная модель данных — https://en.wikipedia.org/wiki/Associative_model_of_data
4. Бинарные отношения — https://ru.wikipedia.org/wiki/Бинарное_отношение
