# Анализ проекта jsonRVM

## Обзор

jsonRVM (json Relations Model Virtual Machine) — это виртуальная машина для исполнения программ, написанных на декларативном языке "Модель Отношений" (Relations Model, RM). Программы представляются в формате JSON и интерпретируются как байткод. Проект реализован на C++17 и предоставляет уникальный подход к метапрограммированию через сущностно-ориентированную парадигму.

**Версия:** 3.0.0
**Лицензия:** MIT
**Автор:** Вертушкин Роман Павлович (2016-2021)

---

## Сильные стороны

### 1. Архитектурные преимущества

#### 1.1. Декларативный подход
- Программы описывают *что* должно быть сделано, а не *как*
- JSON-представление обеспечивает универсальность и читаемость
- Гомоиконичность: код и данные имеют одинаковую структуру

#### 1.2. Модель триединой сущности
- Уникальная концепция: каждая сущность определяется триплетом (субъект, отношение, объект)
- Поддержка MVC-паттерна на уровне языка: Model ($obj), View ($sub), Controller ($rel)
- Рекурсивная и фрактальная природа модели позволяет описывать сложные иерархические системы

#### 1.3. Встроенный параллелизм
- Автоматическое распараллеливание: объекты JSON исполняют ключи параллельно (`std::execution::par`)
- Массивы обеспечивают последовательное выполнение
- Потокобезопасность через мьютексы (`std::mutex`, `std::lock_guard`)

#### 1.4. Расширяемость
- Система плагинов через динамические библиотеки (DLL)
- Функция `import_relations_model_to` для регистрации словарей отношений
- Абстракция базы данных через `database_api` интерфейс

### 2. Функциональные преимущества

#### 2.1. Богатый базовый словарь
Реализовано более 60 базовых операций:
- **Математика:** `+`, `-`, `*`, `:`, `pow`, `sqrt`, `sum`
- **Логика:** `==`, `!=`, `<`, `>`, `&&`, `^` (XOR)
- **Строки:** `string/=`, `string/+=`, `string/find`, `string/split`, `string/join`
- **Управление:** `if_rel_then_obj_else_sub`, `then`, `else`, `while`, `switch/*`
- **Данные:** `where`, `union`, `size`, `get`, `set`, `erase`, `foreachobj`, `foreachsub`
- **Типы:** `is_array`, `is_string`, `is_number`, `is_null`, и др.
- **Генерация:** `xml`, `html`, `tag` для создания разметки
- **Время:** `steady_clock/milliseconds`, `steady_clock/seconds`, и др.

#### 2.2. Гибкая адресация
- Абсолютная адресация: `/entity/property/subproperty`
- Относительная контекстная адресация: `$ent`, `$obj`, `$sub`, `$rel`
- Многоуровневая контекстная адресация: `$$ent`, `$$$obj`, `$$$$rel` (до 4 уровней вложенности)
- Ссылки через `$ref` для динамического разрешения

#### 2.3. Обработка исключений
- JSON-исключения с полным контекстом ошибки
- Операции `throw` и `catch` на уровне языка
- Детальная трассировка через `vm_ctx::throw_json()`

### 3. Технические преимущества

#### 3.1. Качество кода
- Подробная документация в формате Doxygen
- Использование современного C++17 (execution policies, string literals)
- Автоматическая генерация документации через GitHub Actions

#### 3.2. Зависимости
- nlohmann/json — надёжная библиотека для работы с JSON
- doctest — быстрый фреймворк для тестирования
- cpp-httplib — HTTP/HTTPS клиент/сервер
- xml2json — конвертация XML в JSON

#### 3.3. Тестирование
- Unit-тесты на doctest
- Тестовые JSON-сценарии для различных функций
- Проверка адресации, фильтрации, производительности

---

## Слабые стороны

### 1. Архитектурные ограничения

#### 1.1. Платформозависимость
- **Критично:** DLL-загрузка работает только на Windows (`windows.h`, `LoadLibrary`, `HMODULE`)
- Отсутствует кроссплатформенная абстракция для динамической загрузки
- Использование CP1251 для имён файлов — ограничение для не-Windows систем

#### 1.2. Ограниченная глубина контекста
- Жёстко закодированы только 4 уровня контекстной адресации (`$`, `$$`, `$$$`, `$$$$`)
- Расширение требует модификации исходного кода vm.rm.h

#### 1.3. Отсутствие оптимизаций
- Нет JIT-компиляции или кэширования байткода
- Каждое исполнение проходит полную интерпретацию
- Отсутствует ленивая вычисление (lazy evaluation)

### 2. Функциональные ограничения

#### 2.1. Неполная реализация database_api
- `query_entity` — заглушка (только вывод в консоль)
- Нет поддержки транзакций
- Нет механизма миграций или версионирования схемы

#### 2.2. Ограниченная работа со строками
- Нет регулярных выражений
- Нет форматирования строк (printf-style)
- Отсутствует работа с Unicode (только CP1251 ↔ UTF-8)

#### 2.3. Отсутствующие возможности
- Нет модульной системы (namespace/module)
- Нет механизма импорта JSON-файлов как модулей
- Отсутствует отладчик или пошаговое исполнение
- Нет профилировщика производительности

### 3. Технические проблемы

#### 3.1. Код
- Смешение стилей: MSVC-специфичный синтаксис (`for each`)
- Устаревшие конструкции (`char*` вместо `std::string_view`)
- Отсутствует форматирование кода (clang-format)
- Некоторые функции не имеют описания (`""s` в `add_base_entity`)

#### 3.2. Сборка
- Нет CI/CD для тестирования (только Doxygen публикация)
- CMakeLists.txt — опечатка: `ENABLE_TEST` vs `ENABLE_TESTS`
- Отсутствует vcpkg/conan интеграция для зависимостей

#### 3.3. Документация
- README.md содержит устаревшие badge-ссылки (workflow/status)
- Часть документации только на русском языке
- Нет примеров интеграции с внешними проектами

### 4. Безопасность

#### 4.1. Потенциальные уязвимости
- Нет санитизации путей при загрузке файлов
- DLL-загрузка без проверки подписи
- Возможен DoS через глубокую рекурсию JSON

---

## Статистика проекта

| Метрика | Значение |
|---------|----------|
| Строк кода (headers) | ~2500 |
| Базовых операций | 60+ |
| Тестовых сценариев | 15+ |
| Документация (doc/) | 10 файлов |
| Третьесторонние библиотеки | 5 |

---

## Заключение

jsonRVM представляет собой инновационный проект с уникальной концептуальной основой — моделью отношений (Relations Model). Сильные стороны проекта включают декларативный подход, встроенный параллелизм и богатый базовый словарь операций. Основные слабости связаны с платформозависимостью (Windows-only для DLL), отсутствием кроссплатформенной поддержки и некоторыми техническими долгами в коде.

Проект имеет значительный потенциал для применения в области:
- Конфигурационных систем
- DSL для бизнес-логики
- Моделирования иерархических систем
- Прототипирования и метапрограммирования

Для дальнейшего развития рекомендуется сфокусироваться на кроссплатформенности, улучшении производительности и расширении экосистемы примеров и документации.
